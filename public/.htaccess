DirectoryIndex index.html
Options -MultiViews

<IfModule pagespeed_module>
    ModPagespeed off
</IfModule>

# Single rewrite engine declaration
RewriteEngine On
RewriteBase /

# Force HTTPS and enable HSTS (cPanel/Apache)
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Send HSTS header on HTTPS responses only
<IfModule mod_headers.c>
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" env=HTTPS
</IfModule>

# Canonicalize duplicate segment: /news/news/* → /news/*
RewriteRule ^news/news/(.+)$ news/$1 [R=301,L]

# Canonicalize News (avoid /news.html)
RewriteRule ^news\.html$ news/ [R=301,L]
RewriteRule ^news$ news/ [R=301,L]

# Homepage
RewriteRule ^$ index.html [L]

# Serve Next.js static assets as-is (before other rules)
RewriteRule ^_next/ - [L]

# Serve existing files and directories unchanged
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Handle Next.js static export structure for news articles
# /news/article-slug → /news/article-slug/ (add trailing slash)
RewriteCond %{REQUEST_URI} ^/news/([^/]+)$
RewriteCond %{DOCUMENT_ROOT}/news/%1/ -d
RewriteRule ^news/([^/]+)$ news/$1/ [R=301,L]

# Serve news article index.html files
# /news/article-slug/ → /news/article-slug/index.html
RewriteCond %{REQUEST_URI} ^/news/([^/]+)/$
RewriteCond %{DOCUMENT_ROOT}/news/%1/index.html -f
RewriteRule ^news/([^/]+)/$ news/$1/index.html [L]

# Main news page
RewriteRule ^news/$ news/index.html [L]

# Add trailing slash for other physical directories
RewriteCond %{REQUEST_FILENAME} -d
RewriteCond %{REQUEST_URI} !/$
RewriteRule ^(.+)$ $1/ [R=301,L]

# Serve directory index for trailing-slash URLs
RewriteCond %{REQUEST_FILENAME} -d
RewriteCond %{REQUEST_FILENAME}/index.html -f
RewriteRule ^(.+)/$ $1/index.html [L]

# Fallback: if a clean URL has a sibling .html, serve it
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.+)$ $1.html [L]

# Use exported 404 page for missing routes
ErrorDocument 404 /404.html
ErrorDocument 403 /404.html
